--// è¼‰å…¥ Rayfield UI åº«
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

--// å»ºç«‹ä¸»è¦–çª—
local Window = Rayfield:CreateWindow({
   Name = "ğŸ§Ÿ è¿‘æˆ°ç‰¹åŒ–å¹³æ»‘æ“´å¤§å™¨",
   LoadingTitle = "è¼‰å…¥è…³æœ¬ä¸­...",
   LoadingSubtitle = "by Rayfield",
   ConfigurationSaving = { Enabled = false },
   Discord = { Enabled = false },
   KeySystem = false
})

--// å»ºç«‹åˆ†é 
local Tab = Window:CreateTab("ä¸»è¦æ§åˆ¶", 4483362458)

--// æœå‹™èˆ‡å…¨åŸŸè®Šæ•¸
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- ã€è¿‘æˆ°ç‰¹åŒ–é è¨­å€¼ã€‘
_G.HitboxEnabled = false
_G.MaxHitboxSize = 15     -- é è·é›¢ä¾ç„¶ä¿æŒ 15 çš„å¤§é ­
_G.MinHitboxSize = 4.5    -- ã€ä¿®æ”¹ã€‘è²¼è‡‰æ™‚çš„æœ€å°å°ºå¯¸èª¿å¤§ (åŸæœ¬æ˜¯ 2ï¼Œç¾åœ¨æ˜¯ 4.5ï¼Œéš¨ä¾¿ç éƒ½ä¸­)
_G.MaxDistance = 35       -- ã€ä¿®æ”¹ã€‘è·é›¢ 35 ä»¥å…§æ‰é–‹å§‹æ…¢æ…¢ç¸®å° (å»¶å¾Œç¸®å°æ™‚é–“)
_G.MinDistance = 4        -- ã€ä¿®æ”¹ã€‘ç›´åˆ°è·é›¢ 4 (æ®åˆ€æ¥µé™è·é›¢) æ‰æœƒç¸®åˆ°æœ€å°
_G.HitboxTransparency = 0.5

--// æ¢å¾©é è¨­å¤§å°çš„å‡½æ•¸
local function ResetHitboxes()
    local zombies = game.Workspace:FindFirstChild("Zombies")
    if zombies then
        for _, zombie in pairs(zombies:GetChildren()) do
            if zombie:IsA("Model") and zombie:FindFirstChild("Head") then
                local head = zombie.Head
                head.Size = Vector3.new(1.2, 1.2, 1.2)
                head.Transparency = 0
                head.CanCollide = true
            end
        end
    end
end

--// åŸºç¤é–‹é—œèˆ‡è¨­å®š
Tab:CreateToggle({
   Name = "å•Ÿå‹•å¹³æ»‘ç¸®æ”¾ (å¯¦æ™‚æ¼”ç®—)",
   CurrentValue = false,
   Flag = "HitboxToggle",
   Callback = function(Value) 
      _G.HitboxEnabled = Value 
      if not Value then ResetHitboxes() end
   end,
})

Tab:CreateLabel("=== å°ºå¯¸è¨­å®š (Size) ===")

Tab:CreateSlider({
   Name = "æœ€é æ™‚çš„ã€æœ€å¤§å°ºå¯¸ã€‘",
   Range = {5, 50},
   Increment = 1,
   Suffix = "Studs",
   CurrentValue = 15,
   Flag = "MaxSizeSlider",
   Callback = function(Value) _G.MaxHitboxSize = Value end,
})

Tab:CreateSlider({
   Name = "è²¼è‡‰æ™‚çš„ã€æœ€å°å°ºå¯¸ã€‘ (è¿‘æˆ°çœ‹é€™è£¡)",
   Range = {1, 15},
   Increment = 0.5,
   Suffix = "Studs",
   CurrentValue = 4.5, -- é è¨­çµ¦è¿‘æˆ°èˆ’æœçš„å°ºå¯¸
   Flag = "MinSizeSlider",
   Callback = function(Value) _G.MinHitboxSize = Value end,
})

Tab:CreateLabel("=== è·é›¢é–¾å€¼ (æ™‚æ©Ÿèª¿æ•´) ===")

Tab:CreateSlider({
   Name = "è·é›¢ä¸Šé™ (ä½æ–¼æ­¤è·é›¢æ‰é–‹å§‹ç¸®å°)",
   Range = {10, 300},
   Increment = 5,
   Suffix = "Studs",
   CurrentValue = 35, -- é è¿‘åˆ° 35 æ‰é–‹å§‹ç¸®
   Flag = "MaxDistSlider",
   Callback = function(Value) _G.MaxDistance = Value end,
})

Tab:CreateSlider({
   Name = "å®‰å…¨è·é›¢ (æ®åˆ€è·é›¢ï¼Œåˆ°é”å¾Œä¸å†ç¸®å°)",
   Range = {2, 50},
   Increment = 1,
   Suffix = "Studs",
   CurrentValue = 4, -- æ®åˆ€æ¥µé™ç¯„åœ
   Flag = "MinDistSlider",
   Callback = function(Value) _G.MinDistance = Value end,
})

Tab:CreateLabel("=== å…¶ä»–å¤–è§€ ===")

Tab:CreateSlider({
   Name = "é€æ˜åº¦ (Transparency)",
   Range = {0, 1},
   Increment = 0.1,
   Suffix = "",
   CurrentValue = 0.5,
   Flag = "HitboxTransSlider",
   Callback = function(Value) _G.HitboxTransparency = Value end,
})

Tab:CreateButton({
   Name = "å¼·åˆ¶é‡ç½®æ‰€æœ‰æ®­å±é ­éƒ¨",
   Callback = function()
      _G.HitboxEnabled = false
      Rayfield:Notify({Title = "å·²é‡ç½®", Content = "åŠŸèƒ½å·²é—œé–‰ä¸¦æ¢å¾©åŸç‹€", Duration = 2, Image = 4483362458})
   end,
})

--// æ ¸å¿ƒå¯¦æ™‚å¹³æ»‘æ¼”ç®—è¿´åœˆ
RunService.Heartbeat:Connect(function()
    if not _G.HitboxEnabled then return end
    
    local zombies = game.Workspace:FindFirstChild("Zombies")
    local character = LocalPlayer.Character
    local hrp = character and character:FindFirstChild("HumanoidRootPart")
    
    if zombies and hrp then
        for _, zombie in pairs(zombies:GetChildren()) do
            if zombie:IsA("Model") and zombie:FindFirstChild("Head") then
                local head = zombie.Head
                local zombieRoot = zombie:FindFirstChild("HumanoidRootPart") or head
                local distance = (hrp.Position - zombieRoot.Position).Magnitude
                
                -- é˜²å‘†ï¼šç¢ºä¿ MaxDistance å¤§æ–¼ MinDistance
                local realMaxDist = math.max(_G.MaxDistance, _G.MinDistance + 1)
                
                local clampedDistance = math.clamp(distance, _G.MinDistance, realMaxDist)
                local distanceRatio = (clampedDistance - _G.MinDistance) / (realMaxDist - _G.MinDistance)
                local targetSize = _G.MinHitboxSize + distanceRatio * (_G.MaxHitboxSize - _G.MinHitboxSize)
                
                head.Size = Vector3.new(targetSize, targetSize, targetSize)
                head.Transparency = _G.HitboxTransparency
                head.CanCollide = false
            end
        end
    end
end)